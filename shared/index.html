<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인</title>
    <link rel="stylesheet" href="/style.css?v=20250111">
    <link rel="stylesheet" href="/repair-status-modal.css">
</head>
<body>
    <!-- 네비게이션 바 -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="nav-brand" onclick="showHome()">깜냥컴퓨터</a>
            <ul class="nav-menu" id="navMenu" style="display: none;">
                <li><a href="#" onclick="showHome()">홈</a></li>
                <li><a href="#" onclick="showCustomers()">고객</a></li>
                <li><a href="#" onclick="showProducts()">제품</a></li>
                <li><a href="#" onclick="showLedger()">장부</a></li>
                <li><a href="#" onclick="showAccounting()">회계</a></li>
                <li><a href="../backup/backup-management.html" target="_blank">백업관리</a></li>
                <li><a href="#" onclick="showSettings()">설정</a></li>
            </ul>
            <div class="user-info" id="userInfo" style="display: none;">
                <span id="userName">사용자</span>
                <button onclick="logout()" class="btn btn-outline">로그아웃</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="login-form" style="display: none;">
            <h2>로그인</h2>
            <form id="loginForm">
                <div class="form-group">
                    <input type="text" id="username" placeholder="아이디" required>
                </div>
                <div class="form-group">
                    <input type="password" id="password" placeholder="비밀번호" required>
                </div>
                <button type="submit">로그인</button>
            </form>
            <p>계정이 없으신가요? <a href="#" id="showRegister">회원가입</a></p>
        </div>

        <div class="register-form" style="display: none;">
            <h2>회원가입</h2>
            <form id="registerForm">
                <div class="form-group">
                    <input type="text" id="regName" placeholder="이름" required>
                </div>
                <div class="form-group">
                    <input type="text" id="regUsername" placeholder="아이디" required>
                </div>
                <div class="form-group">
                    <input type="password" id="regPassword" placeholder="비밀번호" required>
                </div>
                <div class="form-group">
                    <input type="tel" id="regPhone" placeholder="전화번호" required>
                </div>
                <button type="submit">가입하기</button>
            </form>
            <p>이미 계정이 있으신가요? <a href="#" id="showLogin">로그인</a></p>
        </div>
        
        <!-- 홈 화면 -->
        <div class="home-screen" id="homeScreen">
            <h1>깜냥컴퓨터에 오신 것을 환영합니다</h1>
            <p>로그인하여 서비스를 이용해보세요</p>
            <button onclick="showLoginForm()" class="btn btn-primary">로그인하기</button>
        </div>

        <!-- 대시보드 화면 -->
        <div class="dashboard" id="dashboard" style="display: none;">
            <h1>대시보드</h1>
            
            <!-- 수리 현황 섹션 -->
            <div class="repair-status-section">
                <div class="section-header">
                    <h2>🔧 수리 현황</h2>
                    <div class="section-controls">
                        <button class="btn btn-outline" onclick="refreshRepairStatus()">🔄 새로고침</button>
                    </div>
                </div>
                
                <!-- 수리 진행 상태 카드들 -->
                <div class="status-cards">
                    <div class="status-card pending" onclick="openRepairStatusModal('접수')" style="cursor: pointer;">
                        <div class="status-icon">📝</div>
                        <div class="status-content">
                            <div class="status-title">접수</div>
                            <div class="status-value" id="pendingCount">0건</div>
                        </div>
                    </div>
                    
                    <div class="status-card in-progress" onclick="openRepairStatusModal('위탁 접수')" style="cursor: pointer;">
                        <div class="status-icon">📦</div>
                        <div class="status-content">
                            <div class="status-title">위탁 접수</div>
                            <div class="status-value" id="inProgressCount">0건</div>
                        </div>
                    </div>
                    
                    <div class="status-card completed" onclick="openRepairStatusModal('수리 완료')" style="cursor: pointer;">
                        <div class="status-icon">✅</div>
                        <div class="status-content">
                            <div class="status-title">수리 완료</div>
                            <div class="status-value" id="completedCount">0건</div>
                        </div>
                    </div>
                    
                    <div class="status-card warranty" onclick="openRepairStatusModal('보증 중')" style="cursor: pointer;">
                        <div class="status-icon">🛡️</div>
                        <div class="status-content">
                            <div class="status-title">보증 중</div>
                            <div class="status-value" id="warrantyCount">0건</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 진행중인 수리 내역 섹션 -->
            <div class="region-search-section">
                <div class="section-header">
                    <h2>🔧 진행중인 수리 내역</h2>
                    <div class="section-controls">
                        <input type="text" id="regionSearchInput" placeholder="지역명 또는 고객명을 입력하세요..." onkeyup="searchByRegion()">
                        <button class="btn btn-outline" onclick="clearRegionSearch()">초기화</button>
                        <button class="btn btn-primary" onclick="showAllRepairs()">전체 보기</button>
                    </div>
                </div>
                
                <div class="search-results" id="regionSearchResults">
                    <div class="loading">진행중인 수리 내역을 불러오는 중...</div>
                </div>
            </div>


            <!-- 매출/매입 분석 섹션 -->
            <div class="analysis-section">
                <div class="analysis-header">
                    <h2>📊 매출/매입 분석</h2>
                    <div class="analysis-controls">
                        <select id="analysisPeriod" onchange="updateAnalysis()">
                            <option value="daily">일별</option>
                            <option value="monthly" selected>월별</option>
                            <option value="yearly">연도별</option>
                        </select>
                        <button class="btn btn-primary" onclick="refreshAnalysis()">🔄 새로고침</button>
                    </div>
                </div>
                
                <!-- 요약 카드들 -->
                <div class="summary-cards">
                    <div class="summary-card revenue">
                        <div class="card-icon">💰</div>
                        <div class="card-content">
                            <div class="card-title">총 매출</div>
                            <div class="card-value" id="totalRevenue">0원</div>
                            <div class="card-subtitle" id="revenueCount">0건</div>
                        </div>
                    </div>
                    
                    <div class="summary-card expense">
                        <div class="card-icon">💸</div>
                        <div class="card-content">
                            <div class="card-title">총 매입</div>
                            <div class="card-value" id="totalExpense">0원</div>
                            <div class="card-subtitle" id="expenseCount">0건</div>
                        </div>
                    </div>
                    
                    <div class="summary-card net">
                        <div class="card-icon">📈</div>
                        <div class="card-content">
                            <div class="card-title">순이익</div>
                            <div class="card-value" id="netProfit">0원</div>
                            <div class="card-subtitle" id="profitMargin">0%</div>
                        </div>
                    </div>
                    
                    <div class="summary-card vat">
                        <div class="card-icon">🧾</div>
                        <div class="card-content">
                            <div class="card-title">부가세</div>
                            <div class="card-value" id="totalVat">0원</div>
                            <div class="card-subtitle" id="vatBreakdown">매출/매입</div>
                        </div>
                    </div>
                </div>
                
                <!-- 상세 분석 테이블 -->
                <div class="analysis-table-container">
                    <h3>상세 분석</h3>
                    <div class="table-wrapper">
                        <table class="analysis-table" id="analysisTable">
                            <thead>
                                <tr>
                                    <th>기간</th>
                                    <th class="number">매출 공급가액</th>
                                    <th class="number">매출 부가세</th>
                                    <th class="number">매출 총액</th>
                                    <th class="number">매입 공급가액</th>
                                    <th class="number">매입 부가세</th>
                                    <th class="number">매입 총액</th>
                                    <th class="number">순이익</th>
                                </tr>
                            </thead>
                            <tbody id="analysisTableBody">
                                <tr>
                                    <td colspan="8" class="loading">데이터를 분석하는 중...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
    
    <!-- 수리 현황 모달 -->
    <div id="repairStatusModal" style="display: none;">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                <h2 id="repairStatusModalTitle">수리 현황 상세</h2>
                <button class="close-btn" onclick="closeRepairStatusModal()">&times;</button>
            </div>
            
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 20px; max-height: calc(90vh - 120px); scrollbar-width: thin; scrollbar-color: #ced4da #f8f9fa;">
                <!-- 필터 섹션 -->
                <div class="filter-section" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div>
                            <label for="statusFilter">상태 필터:</label>
                            <select id="statusFilter" onchange="updateRepairStatusFilter()" style="margin-left: 8px; padding: 5px 10px; border: 1px solid #ced4da; border-radius: 4px;">
                                <option value="all">전체</option>
                                <option value="접수">접수</option>
                                <option value="위탁 접수">위탁 접수</option>
                                <option value="수리 완료">수리 완료</option>
                                <option value="보증 중">보증 중</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="dateRangeFilter">기간 필터:</label>
                            <select id="dateRangeFilter" onchange="updateRepairStatusFilter()" style="margin-left: 8px; padding: 5px 10px; border: 1px solid #ced4da; border-radius: 4px;">
                                <option value="today">오늘</option>
                                <option value="week">이번 주</option>
                                <option value="month" selected>이번 달</option>
                                <option value="quarter">이번 분기</option>
                                <option value="year">올해</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="searchInput">검색:</label>
                            <input type="text" id="searchInput" placeholder="고객명, 기기명, 번호 검색..." 
                                   onkeyup="filterRepairStatusTable()" 
                                   style="margin-left: 8px; padding: 5px 10px; border: 1px solid #ced4da; border-radius: 4px; width: 250px;">
                        </div>
                        
                        <button onclick="loadRepairStatusData()" class="btn btn-primary" style="padding: 6px 15px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            🔄 새로고침
                        </button>
                    </div>
                </div>
                
                <!-- 요약 정보 -->
                <div id="repairStatusSummary" style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>총 수리 건수:</strong> <span id="totalRepairCount">0건</span></div>
                        <div><strong>접수 대기:</strong> <span id="summaryPendingCount">0건</span></div>
                        <div><strong>진행 중:</strong> <span id="summaryInProgressCount">0건</span></div>
                        <div><strong>완료:</strong> <span id="summaryCompletedCount">0건</span></div>
                        <div><strong>보증 중:</strong> <span id="summaryWarrantyCount">0건</span></div>
                    </div>
                </div>
                
                <!-- 수리 현황 테이블 -->
                <div style="overflow-x: auto; max-height: 500px; border: 1px solid #dee2e6; border-radius: 8px;">
                    <table id="repairStatusTable" style="width: 100%; border-collapse: collapse; font-size: 14px; background: white;">
                        <thead id="repairStatusTableHead" style="background: #f8f9fa; position: sticky; top: 0; z-index: 10;">
                            <tr>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 80px;">번호</th>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 100px;">접수일</th>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 120px;">고객명</th>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 150px;">기기명</th>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 200px;">문제</th>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 100px;">상태</th>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 100px;">수리비</th>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 100px;">완료일</th>
                                <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center; min-width: 80px;">액션</th>
                            </tr>
                        </thead>
                        <tbody id="repairStatusTableBody">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <div style="font-size: 24px;">📋</div>
                                        <div>수리 현황 데이터를 불러오는 중...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 페이지네이션 -->
                <div id="repairStatusPagination" style="margin-top: 20px; display: flex; justify-content: center; align-items: center; gap: 10px;">
                    <button onclick="changeRepairStatusPage(-1)" class="btn btn-outline" style="padding: 8px 12px; border: 1px solid #ced4da; background: white; border-radius: 4px; cursor: pointer;">이전</button>
                    <span id="repairStatusPageInfo" style="padding: 8px 15px; background: #f8f9fa; border-radius: 4px;">1 / 1</span>
                    <button onclick="changeRepairStatusPage(1)" class="btn btn-outline" style="padding: 8px 12px; border: 1px solid #ced4da; background: white; border-radius: 4px; cursor: pointer;">다음</button>
                </div>
            </div>
            
            <div class="modal-footer" style="flex-shrink: 0; padding: 20px; border-top: 1px solid #e9ecef; background: #f8f9fa; display: flex; justify-content: space-between; align-items: center;">
                <div style="color: #6c757d; font-size: 14px;">
                    <span id="repairStatusTableInfo">총 0건의 수리 현황</span>
                </div>
                <div>
                    <button type="button" class="btn btn-outline" onclick="closeRepairStatusModal()" style="padding: 8px 20px; border: 1px solid #ced4da; background: white; border-radius: 4px; cursor: pointer;">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 수리 상세 정보 모달 -->
    <div id="repairDetailModal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                <h2 id="repairDetailModalTitle">수리 상세 정보</h2>
                <button class="close-btn" onclick="closeRepairDetailModal()">&times;</button>
            </div>
            
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 20px; max-height: calc(90vh - 120px);">
                <div id="repairDetailContent">
                    <!-- 수리 상세 정보가 여기에 동적으로 로드됩니다 -->
                </div>
            </div>
            
            <div class="modal-footer" style="flex-shrink: 0; padding: 20px; border-top: 1px solid #e9ecef; background: #f8f9fa; text-align: right;">
                <button type="button" class="btn btn-outline" onclick="closeRepairDetailModal()" style="padding: 8px 20px; border: 1px solid #ced4da; background: white; border-radius: 4px; cursor: pointer;">닫기</button>
            </div>
        </div>
    </div>
    
    <script src="/products/category-manager.js"></script>
    <script src="/script.js"></script>
</body>
</html>
